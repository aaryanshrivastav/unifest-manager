<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Dashboard - Unifest Manager</title>
    <link rel="stylesheet" href="../css/volunteerhome.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="18" fill="#6B7EE8"/>
                    <text x="20" y="27" font-size="20" font-weight="bold" fill="white" text-anchor="middle">U</text>
                </svg>
            </div>
            <span class="brand-name">Unifest Manager</span>
        </div>
        <div class="nav-links">
            <a href="volunteerhome.html" class="active">Home</a>
            <a href="volunteerevent.html">Events</a>
            <a href="volunteershift.html">Shift</a>
        </div>
    </nav>

    <div class="container">
        <div class="profile-card">
            <h1 class="page-title">Volunteer Profile</h1>
            
            <div class="profile-info">
                <div class="info-item">
                    <label>Name:</label>
                    <span id="profileName">Loading...</span>
                </div>
                
                <div class="info-item">
                    <label>Year:</label>
                    <span id="profileYear">Loading...</span>
                </div>
                
                <div class="info-item">
                    <label>Experience:</label>
                    <p id="profileExperience">Loading...</p>
                </div>
            </div>

            <a href="volunteerevent.html" class="volunteer-btn">Start Volunteering</a>
        </div>
    </div>

    <script>
        const vToken = localStorage.getItem('token');
        const vUser = JSON.parse(localStorage.getItem('user') || 'null');
        if (!vToken || !vUser) {
            window.location.href = '/html/login.html';
        } else if (vUser.role !== 'VOLUNTEER') {
            const roleRoutes = { ADMIN:'/html/adminhome.html', COORDINATOR:'/html/coordinatorhome.html', FACULTY:'/html/facultyhome.html', USER:'/html/userhome.html' };
            window.location.href = roleRoutes[vUser.role] || '/html/login.html';
        }

        function safe(val, fallback='â€”') { return (val === undefined || val === null || val === '') ? fallback : val; }

        async function loadVolunteerHome() {
            try {
                const res = await fetch(`/volunteer/${vUser.user_id}/home`, { headers: { 'Authorization': `Bearer ${vToken}` } });
                const data = await res.json().catch(() => ({}));
                if (!res.ok) throw new Error(data.message || `Failed (${res.status})`);

                const name = data.volunteer?.name || `${safe(data.volunteer?.first_name || vUser.first_name, '')} ${safe(data.volunteer?.last_name || vUser.last_name, '')}`.trim() || 'Volunteer';
                document.getElementById('profileName').textContent = name;
                document.getElementById('profileYear').textContent = safe(data.volunteer?.year);
                document.getElementById('profileExperience').textContent = safe(data.volunteer?.experience, '');
            } catch (e) {
                document.getElementById('profileName').textContent = 'Error loading profile';
            }
        }

        document.addEventListener('click', async (e) => {
            const t = e.target.closest('a');
            if (t && /logout/i.test(t.getAttribute('href') || '')) {
                e.preventDefault();
                try { await fetch('/auth/logout', { method: 'POST', headers: { 'Authorization': `Bearer ${vToken}` } }); } catch (_) {}
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '/html/login.html';
            }
        });

        loadVolunteerHome();
    </script>
</body>
</html>