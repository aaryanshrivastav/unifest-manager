<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Event Details - Unifest</title>
  <link rel="stylesheet" href="../css/eventdetails.css">
</head>
<body data-page="eventdetails">
  <header class="header">
    <div class="container nav">
      <div class="brand"><span class="logo">U</span> Unifest</div>
      <nav class="nav-links">
        <a href="userhome.html">Home</a>
        <a href="userevent.html">Events</a>
        <a href="#" class="active">Event Details</a>
        <a href="#" id="logoutBtn">Logout</a>
      </nav>
    </div>
  </header>

  <main class="container profile-container">
    <div class="card">
      <h1 id="eventTitle">Event Title</h1>
      <p id="eventDescription" class="small">Loading event details...</p>

      <div class="info-grid">
        <div class="info-item"><div class="info-label">Date</div><div class="info-value" id="eventDate">â€”</div></div>
        <div class="info-item"><div class="info-label">Venue</div><div class="info-value" id="eventVenue">â€”</div></div>
        <div class="info-item"><div class="info-label">Category</div><div class="info-value" id="eventCategory">â€”</div></div>
        <div class="info-item"><div class="info-label">Coordinator</div><div class="info-value" id="eventCoord">â€”</div></div>
      </div>

      <div class="actions">
        <a href="register.html" class="btn primary" id="registerEvent">Register</a>
        
      </div>
    </div>
  </main>

    <script type="module">
document.addEventListener('DOMContentLoaded', async () => {
  console.log("âœ… Event Details page loaded");

  const urlParams = new URLSearchParams(window.location.search);
  const event_id = urlParams.get('event_id');
  console.log("ğŸ” Extracted event_id from URL:", event_id);

  if (!event_id) {
    console.error("âŒ No event_id found in URL");
    document.getElementById('eventDescription').textContent = 'No event selected.';
    return;
  }

  const token = localStorage.getItem('token');
  if (!token) {
    console.warn("âš ï¸ No token found. Redirecting to login...");
    window.location.href = '/html/login.html';
    return;
  }

  try {
    console.log(`ğŸ“¡ Fetching details for event_id: ${event_id}`);
    const res = await fetch(`http://localhost:5000/event/${event_id}`, {
      headers: { Authorization: `Bearer ${token}` },
    });

    console.log("ğŸ“¥ Response status:", res.status);

    const text = await res.text();
    console.log("ğŸ“„ Raw response text:", text);

    if (!res.ok) {
      throw new Error(`Failed to fetch event details (${res.status})`);
    }

    const event = JSON.parse(text);
    console.log("âœ… Parsed event data:", event);

    document.getElementById('eventTitle').textContent = event.event_name;
    document.getElementById('eventDescription').textContent = event.description || 'No description available.';
    document.getElementById('eventDate').textContent = event.event_date || 'â€”';
    document.getElementById('eventVenue').textContent = event.venue_name || 'â€”';
    document.getElementById('eventCategory').textContent = event.category || 'â€”';
    document.getElementById('eventCoord').textContent = event.coordinator_name || 'â€”';

    console.log("ğŸ¯ Event details rendered successfully");
  } catch (err) {
    console.error("ğŸ’¥ Error loading event details:", err);
    document.getElementById('eventDescription').textContent = 'Error loading event details.';
  }
});
</script>
</body>
</html>
