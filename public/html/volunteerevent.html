<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Events - Unifest Manager</title>
    <link rel="stylesheet" href="../css/volunteerevent.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="18" fill="#6B7EE8"/>
                    <text x="20" y="27" font-size="20" font-weight="bold" fill="white" text-anchor="middle">U</text>
                </svg>
            </div>
            <span class="brand-name">Unifest Manager</span>
        </div>
        <div class="nav-links">
            <a href="volunteerhome.html">Home</a>
            <a href="volunteerevent.html" class="active">Events</a>
            <a href="volunteershift.html">Shift</a>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1 class="page-title">Volunteer Events</h1>
            <p class="page-subtitle">Browse available events and register to volunteer</p>
        </div>

        <div id="eventsContainer" class="events-grid">
            <!-- Events will be dynamically loaded here -->
        </div>

        <div id="noEvents" class="no-events" style="display: none;">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <h2>No Events Available</h2>
            <p>There are no events available for volunteering at the moment.</p>
        </div>
    </div>

    <script>
        // Auth guard for Volunteer
        const eToken = localStorage.getItem('token');
        const eUser = JSON.parse(localStorage.getItem('user') || 'null');
        if (!eToken || !eUser) {
            window.location.href = '/html/login.html';
        } else if (eUser.role !== 'VOLUNTEER') {
            const roleRoutes = { ADMIN:'/html/adminhome.html', COORDINATOR:'/html/coordinatorhome.html', FACULTY:'/html/facultyhome.html', USER:'/html/userhome.html' };
            window.location.href = roleRoutes[eUser.role] || '/html/login.html';
        }

        const eventsContainer = document.getElementById('eventsContainer');
        const noEvents = document.getElementById('noEvents');

        function card(event) {
            const dateTxt = event.start_time || event.event_date;
            const when = dateTxt ? new Date(dateTxt).toLocaleString() : 'TBD';
            const venue = event.venue || event.venue_name || 'Venue TBD';
            return `
            <div class="event-card">
                <h3>${event.event_name || 'Event'}</h3>
                <p class="event-description">${event.description || ''}</p>
                <div class="event-times">
                    <p>When: ${when}</p>
                    <p>Where: ${venue}</p>
                </div>
            </div>`;
        }

        async function loadVolunteerEvents() {
            try {
                const res = await fetch(`/volunteer/${eUser.user_id}/events`, { headers: { 'Authorization': `Bearer ${eToken}` } });
                const data = await res.json().catch(() => ({}));
                if (!res.ok) throw new Error(data.message || `Failed (${res.status})`);
                const events = Array.isArray(data.events) ? data.events : (Array.isArray(data) ? data : []);
                if (!events.length) {
                    noEvents.style.display = 'block';
                    eventsContainer.innerHTML = '';
                    return;
                }
                noEvents.style.display = 'none';
                eventsContainer.innerHTML = events.map(card).join('');
            } catch (e) {
                noEvents.style.display = 'block';
                eventsContainer.innerHTML = '';
            }
        }

        loadVolunteerEvents();
    </script>
</body>
</html>