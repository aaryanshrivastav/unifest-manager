<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Register Event - Faculty</title>
  <link rel="stylesheet" href="../css/facultyregister.css">
</head>
<body data-page="register">
  <header class="header">
    <div class="container nav">
      <div class="brand"><span class="logo">U</span> Unifest</div>
      <nav class="nav-links">
        <a href="facultyhome.html">Home</a>
        <a href="facultyregister.html" class="active">Register</a>
        <a href="facultyevents.html">Events</a>
        <a href="#" id="logoutBtn">Logout</a>
      </nav>
    </div>
  </header>

  <main class="container profile-container">
    <div class="card">

    <h2 class="section-title">Event Registration</h2>
    <form id="eventForm" class="event-form">

      <div class="form-group">
        <label for="eventName">Event Name</label>
        <input type="text" id="eventName" placeholder="Enter event name" required>
      </div>

      <div class="form-group">
        <label for="eventDesc">Description</label>
        <textarea id="eventDesc" placeholder="Enter event description" required></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="eventStartDate">Event Start Date</label>
          <input type="date" id="eventStartDate" required>
        </div>
        <div class="form-group">
          <label for="eventStartTime">Event Start Time</label>
          <input type="time" id="eventStartTime" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="eventEndDate">Event End Date</label>
          <input type="date" id="eventEndDate" required>
        </div>
        <div class="form-group">
          <label for="eventEndTime">Event End Time</label>
          <input type="time" id="eventEndTime" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="regStart">Registration Start</label>
          <input type="date" id="regStart" required>
        </div>
        <div class="form-group">
          <label for="regEnd">Registration End</label>
          <input type="date" id="regEnd" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="maxParticipants">Max Participants</label>
          <input type="number" id="maxParticipants" min="1" placeholder="Enter max participants" required>
        </div>
        <div class="form-group">
          <label for="eventFees">Fees (â‚¹)</label>
          <input type="number" id="eventFees" min="0" placeholder="Enter fees" required>
        </div>
      </div>

      <div class="form-group">
        <label for="eventVenue">Preferred Venue</label>
        <input type="text" id="eventVenue" placeholder="Enter venue" required>
      </div>

      <div class="actions">
        <button type="submit" class="btn primary">Create Event</button>
      </div>

    </form>
  </div>
</main>


  <script>
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user'));
    
    if (!token || !user || user.role !== 'FACULTY') {
      window.location.href = 'login.html';
    }

    document.getElementById('logoutBtn').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = 'login.html';
    });

    document.getElementById('eventForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      function formatDate(dateStr, timeStr) {
        const date = new Date(dateStr);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}-${month}-${year} ${timeStr}`;
      }

      const eventStartDate = document.getElementById('eventStartDate').value;
      const eventStartTime = document.getElementById('eventStartTime').value;
      const eventEndDate = document.getElementById('eventEndDate').value;
      const eventEndTime = document.getElementById('eventEndTime').value;
      const regStartDate = document.getElementById('regStart').value;
      const regEndDate = document.getElementById('regEnd').value;

      const eventData = {
        event_name: document.getElementById('eventName').value,
        description: document.getElementById('eventDesc').value,
        start_time: formatDate(eventStartDate, eventStartTime),
        end_time: formatDate(eventEndDate, eventEndTime),
        registration_start: formatDate(regStartDate, '00:00'),
        registration_end: formatDate(regEndDate, '23:59'),
        max_participants: parseInt(document.getElementById('maxParticipants').value),
        fees: parseFloat(document.getElementById('eventFees').value),
        venue_id: document.getElementById('eventVenue').value
      };

      try {
        const response = await fetch(`/faculty/${user.user_id}/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(eventData)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Failed to register event');
        }

        alert('Event registered successfully!');
        window.location.href = 'facultyevents.html';
      } catch (error) {
        alert(error.message || 'An error occurred while registering the event');
      }
    });

    const today = new Date().toISOString().split('T')[0];
    document.getElementById('regStart').min = today;
    document.getElementById('regEnd').min = today;

    function validateEventDates() {
      const startDate = document.getElementById('eventStartDate').value;
      const startTime = document.getElementById('eventStartTime').value;
      const endDate = document.getElementById('eventEndDate').value;
      const endTime = document.getElementById('eventEndTime').value;

      if (startDate && startTime && endDate && endTime) {
        const startDateTime = new Date(`${startDate}T${startTime}`);
        const endDateTime = new Date(`${endDate}T${endTime}`);

        if (endDateTime <= startDateTime) {
          alert('Event end date/time must be after start date/time');
          document.getElementById('eventEndDate').value = '';
          document.getElementById('eventEndTime').value = '';
          return false;
        }
      }
      return true;
    }

    document.getElementById('eventEndDate').addEventListener('change', validateEventDates);
    document.getElementById('eventEndTime').addEventListener('change', validateEventDates);

    document.getElementById('regEnd').addEventListener('change', (e) => {
      const startDate = document.getElementById('regStart').value;
      const endDate = e.target.value;
      if (startDate && endDate < startDate) {
        alert('Registration end date must be after start date');
        e.target.value = '';
      }
    });
  </script>
</body>
<!-- FOOTER -->
<footer>
  <p>
    Developed by 
    <a href="https://github.com/mitalisaxena" target="_blank"><strong>Mitali Saxena</strong></a>, 
    <a href="https://github.com/aarushi-chaudhary" target="_blank"><strong>Aarushi Chaudhary</strong></a>, and 
    <a href="https://github.com/aaryanshrivastav" target="_blank"><strong>Aaryan Shrivastav</strong></a> | Batch 4
  </p>
  <p>
    <a href="https://github.com/" target="_blank">Project GitHub Repository</a>
    <a href="https://in.linkedin.com/" target="_blank">linkedin</a>
  </p>
</footer>
</html>
