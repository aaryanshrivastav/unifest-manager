<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Faculty Dashboard - Unifest</title>
  <link rel="stylesheet" href="../css/facultyhome.css">
</head>
<body data-page="faculty">
  <header class="header">
    <div class="container nav">
      <div class="brand"><span class="logo">U</span> Unifest</div>
      <nav class="nav-links">
        <a href="facultyhome.html" class="active">Home</a>
        <a href="facultyregister.html">Register</a>
        <a href="facultyevents.html">Events</a>
        <a href="#" id="logoutBtn">Logout</a>
      </nav>
    </div>
  </header>

  <main class="container profile-container">
    <div class="card">
      <div class="profile-header">
        <div class="profile-avatar" id="facultyAvatar">F</div>
        <div class="profile-info">
          <h1 id="facultyName">Faculty Name</h1>
          <p id="facultyEmail">—</p>
        </div>
      </div>

      <div class="info-grid">
        <div class="info-item"><div class="info-label">Department</div><div class="info-value" id="facultyDept">—</div></div>
        <div class="info-item"><div class="info-label">Phone</div><div class="info-value" id="facultyPhone">—</div></div>
        <div class="info-item"><div class="info-label">Total Events</div><div class="info-value" id="facultyEvents">—</div></div>
      </div>

      <h2 class="section-title">My Events</h2>
      <div id="eventsContainer" class="events-list"></div>
    </div>
  </main>

  <script>
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user'));
    
    if (!token || !user || user.role !== 'FACULTY') {
      window.location.href = 'login.html';
    }

    document.getElementById('logoutBtn').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = 'login.html';
    });

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    async function loadFacultyHome() {
      try {
        const eventsContainer = document.getElementById('eventsContainer');
        const response = await fetch(`/faculty/${user.user_id}/home`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Failed to load faculty data');
        }

        document.getElementById('facultyName').textContent = data.faculty.name;
        document.getElementById('facultyEmail').textContent = data.faculty.email;
        document.getElementById('facultyAvatar').textContent = data.faculty.name.charAt(0);

        document.getElementById('facultyEvents').textContent = data.events.length;

        eventsContainer.innerHTML = data.events.map(event => `
  <div class="event-card">
    <h3>${event.event_name}</h3>
    <p class="event-description">${event.description || 'No description available'}</p>
    <div class="event-times">
      <p>Starts: ${formatDate(event.start_time)}</p>
      <p>Ends: ${formatDate(event.end_time)}</p>
    </div>
    <a href="eventdetails.html?id=${event.event_id}" class="btn view-details">View Details</a>
  </div>
`).join('');

      } catch (error) {
        alert(error.message || 'An error occurred while loading faculty data');
      }
    }

    loadFacultyHome();
  </script>
</body>
<!-- FOOTER -->
<footer>
  <p>
    Developed by 
    <a href="https://github.com/mitalisaxena" target="_blank"><strong>Mitali Saxena</strong></a>, 
    <a href="https://github.com/aarushi-chaudhary" target="_blank"><strong>Aarushi Chaudhary</strong></a>, and 
    <a href="https://github.com/aaryanshrivastav" target="_blank"><strong>Aaryan Shrivastav</strong></a> | Batch 4
  </p>
  <p>
    <a href="https://github.com/" target="_blank">Project GitHub Repository</a>
    <a href="https://in.linkedin.com/" target="_blank">linkedin</a>
  </p>
</footer>
</html>
