<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Faculty Events - Unifest</title>
  <link rel="stylesheet" href="../css/facultyevents.css">
</head>
<body data-page="facultyevents">
  <header class="header">
    <div class="container nav">
      <div class="brand"><span class="logo">U</span> Unifest</div>
      <nav class="nav-links">
        <a href="facultyhome.html">Home</a>
        <a href="facultyregister.html">Register</a>
        <a href="facultyevents.html" class="active">Events</a>
        <a href="#" id="logoutBtn">Logout</a>
      </nav>
    </div>
  </header>

  <main class="container profile-container">
    <div class="card">
      <h2 class="section-title">Events Under Faculty</h2>
      <div id="eventsContainer" class="events-list"></div>
    </div>
  </main>

  <script>
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user'));
    
    if (!token || !user || user.role !== 'FACULTY') {
      window.location.href = 'login.html';
    }

    document.getElementById('logoutBtn').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = 'login.html';
    });

    function formatDate(dateString) {
      if (!dateString) return 'Not set';
      const date = new Date(dateString);
      return date.toLocaleString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function getStatusBadgeClass(status) {
      switch(status.toUpperCase()) {
        case 'APPROVED': return 'badge-success';
        case 'PENDING': return 'badge-warning';
        case 'REJECTED': return 'badge-danger';
        default: return 'badge-secondary';
      }
    }

    async function loadFacultyEvents() {
      try {
        const response = await fetch(`/faculty/${user.user_id}/events`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Failed to load events');
        }

        const eventsContainer = document.getElementById('eventsContainer');
        if (data.events.length === 0) {
          eventsContainer.innerHTML = '<p class="no-events">No events found</p>';
        } else {
          eventsContainer.innerHTML = data.events.map(event => {
            return `
              <div class="event-card">
                <div class="event-header">
                  <h3>${event.EVENT_NAME || event.event_name}</h3>
                  <span class="badge ${getStatusBadgeClass(event.APPROVAL_STATUS || event.approval_status)}">
                    ${event.APPROVAL_STATUS || event.approval_status || 'PENDING'}
                  </span>
                </div>
                <div class="event-times">
                  <p>Start: ${formatDate(event.START_TIME || event.start_time)}</p>
                  <p>End: ${formatDate(event.END_TIME || event.end_time)}</p>
                </div>
                <a href="eventdetails.html?id=${event.EVENT_ID || event.event_id}" class="btn view-details">View Details</a>
              </div>
            `;
          }).join('');
        }
      } catch (error) {
        alert(error.message || 'An error occurred while loading events');
      }
    }

    loadFacultyEvents();
  </script>
</body>
<!-- FOOTER -->
<footer>
  <p>
    Developed by 
    <a href="https://github.com/mitalisaxena" target="_blank"><strong>Mitali Saxena</strong></a>, 
    <a href="https://github.com/aarushi-chaudhary" target="_blank"><strong>Aarushi Chaudhary</strong></a>, and 
    <a href="https://github.com/aaryanshrivastav" target="_blank"><strong>Aaryan Shrivastav</strong></a> | Batch 4
  </p>
  <p>
    <a href="https://github.com/" target="_blank">Project GitHub Repository</a>
    <a href="https://in.linkedin.com/" target="_blank">linkedin</a>
  </p>
</footer>
</html>
